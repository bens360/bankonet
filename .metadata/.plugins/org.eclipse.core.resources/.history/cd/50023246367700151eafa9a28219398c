package DAO;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Collection;
import java.util.Map;

import com.bankonet.Civilite;
import com.bankonet.Client;
import com.bankonet.Compte;
import com.bankonet.CompteCourant;

public class ClientDao {
	
	/**
	 * Méthode testant l'adéquation du couple login / mot de passe, renseigné par le client
	 * @param mdpClient 
	 * @param loginClient 
	 * @return 
	 */
	public static Client recupereClient(String loginClient ,String mdpClient ) {
		String request = "SELECT * FROM client WHERE login='"+ loginClient +"' AND mot_de_passe='"+ mdpClient +"'";
		ResultSet rSclient = JDBCConnexionBDD.jDBCRequestBDD(request);
		Civilite civilite = null;
		Client client = null;
		try {
			while (rSclient.next()) {
				civilite = Civilite.valueOf(Civilite.class, rSclient.getString("civilite"));
				client = new Client(rSclient.getString("id_client"), civilite, rSclient.getString("nom"), rSclient.getString("prenom"), mdpClient, loginClient);				
			}
		} catch (SQLException e) {
			System.out.println("Problème à la récupération du client");
			e.printStackTrace();
		}
		return client;
	}

	/**
	 * Méthode testant l'adéquation du couple login / mot de passe, renseigné par le client
	 * @param mdpClient 
	 * @param loginClient 
	 * @return 
	 */
		public static boolean testLoginMdp(String loginClient, String mdpClient) {
			boolean mdpOKKO = false;						
			Client client = recupereClient(loginClient, mdpClient);
			if (client!=null){
				mdpOKKO = true;
			}
			return mdpOKKO;
		}

	public static Compte SelectioneCompte() {
		System.out.println("On est dans SelectioneCompte");
		Compte compteSelection;
		
		/*
		 try {
		Collection<Compte> collectionDesComptes = client.getComptesList();
		for (Compte compte : collectionDesComptes) {
			System.out.println(compte);
		}
		System.out.println("Choissisez le compte à crediter");
		Scanner sc = new Scanner(System.in);
		String choixUtilisateur = sc.nextLine();
		compteSelectione = ?? */
		
		return compteSelection=null;
	}

	public static void SoldeDesComptes(Client client) {
		try {
			Map<String, Compte> comptesMap = null;
			String request = "SELECT * FROM compte_courant WHERE id_client =" + client.getIdentifiant();
			System.out.println(request);
			ResultSet rSCompteMap = JDBCConnexionBDD.jDBCRequestBDD(request);
			try {
				while (rSCompteMap.next()) {
					CompteCourant compteCourant = new CompteCourant(rSCompteMap.getString("id_compte_courant"), rSCompteMap.getString("intitule"), rSCompteMap.getDouble("solde"), rSCompteMap.getDouble("montant_decouvert_autorise"));
					comptesMap.put("key", compteCourant);
				}
			} catch (SQLException e) {
				System.out.println("Problème à la récupération des comptes");
				e.printStackTrace();
			}
			
			client.setComptesMap(comptesMap);
			Collection<Compte> collectionDesComptes = client.getComptesList();
		for (Compte compte : collectionDesComptes) {
			System.out.println("Le solde du compte: " + compte.getIntitule() + " est de : "+ compte.getSolde());
		}
		} catch (Exception e) {
			System.out.println("Erreur dans Soldes des comptes");
		}
	}

}
